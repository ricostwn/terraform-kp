---
- name: Configure all servers with common setup
  hosts: all
  become: true
  gather_facts: yes
  roles:
    - common

# Install Node Exporter on all servers
- name: Install Node Exporter on all servers
  hosts: all
  become: true
  collections:
    - prometheus.prometheus
  roles:
    - { role: node_exporter, tags: ["monitoring_config"] }

# Configure monitoring server with Prometheus, Grafana, and Nginx Load Balancer
- name: Configure monitoring server
  hosts: monitoring_server
  become: true
  gather_facts: yes
  vars_files:
    - group_vars/secret.yml
  roles:
    - monitoring

# Configure web servers with Docker
- name: Configure web servers with Docker
  hosts: web_servers
  become: true
  gather_facts: yes
  roles:
    - { role: web-server, tags: ["monitoring_config"] }
